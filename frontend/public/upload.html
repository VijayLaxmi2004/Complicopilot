<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Receipt - CompliCopilot</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Add this to the <head> section of all your HTML files -->
    <link rel="icon" href="assets/img/logo.png" type="image/png">
    <link rel="shortcut icon" href="assets/img/logo.png" type="image/png">
</head>
<body>
    <!-- Header -->
    <header class="header dashboard-header">
        <nav class="nav">
            <div class="nav-brand">
                <img src="assets/img/logo.png" alt="CompliCopilot" class="logo">
                <span class="brand-name">CompliCopilot</span>
            </div>
            <div class="dashboard-nav">
                <a href="dashboard.html" class="btn-secondary">‚Üê Back to Dashboard</a>
                <div class="user-menu">
                    <button class="user-avatar">
                        <span class="avatar-text">S</span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Upload Content -->
    <main class="upload-page">
        <div class="container">
            <!-- Progress Indicator -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Upload</div>
                </div>
                <div class="step-connector"></div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Process</div>
                </div>
                <div class="step-connector"></div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Review</div>
                </div>
            </div>

            <!-- Step 1: Upload -->
            <section class="upload-section active" id="upload-step">
                <div class="upload-container">
                    <h1>Upload Your Receipt</h1>
                    <p class="upload-subtitle">Drag and drop your receipt image or click to browse</p>
                    
                    <div class="drop-zone" id="drop-zone">
                        <div class="drop-zone-content">
                            <div class="upload-icon"></div>
                            <div class="drop-text">
                                <h3>Drag & Drop or Click to Upload</h3>
                                <p>Supports JPG, PNG, PDF files up to 10MB each. You can select multiple files.</p>
                            </div>
                            <div class="upload-buttons">
                                <button class="btn-primary" id="choose-files-btn">Choose Files</button>
                                <button class="btn-secondary" id="camera-btn">
                                    <span class="camera-icon">üì∑</span> Use Camera
                                </button>
                            </div>
                        </div>
                        <input type="file" id="file-input" accept="image/*,.pdf" multiple hidden>
                    </div>

                    <!-- File Preview Grid -->
                    <div class="file-preview-grid" id="file-preview-grid" style="display: none;">
                        <div class="preview-header">
                            <h3>Selected Files (<span id="file-count">0</span>)</h3>
                            <button class="btn-secondary btn-small" id="clear-all-btn">Clear All</button>
                        </div>
                        <div class="preview-cards" id="preview-cards"></div>
                        <div class="preview-actions">
                            <button class="btn-secondary" id="add-more-btn">+ Add More</button>
                            <button class="btn-primary glow" id="process-all-btn">Process All Receipts</button>
                        </div>
                    </div>

                    <!-- Upload progress/loading indicator -->
                    <div id="upload-progress" class="upload-progress" style="display:none; text-align:center; margin-top:1em;">
                        <div class="spinner" style="display:inline-block; vertical-align:middle;"></div>
                        <span id="upload-progress-text" style="margin-left:0.5em;">Uploading...</span>
                    </div>
                    <!-- Export to CSV button will be injected by JS after upload -->

                    <div class="upload-tips">
                        <h4>Tips for best results:</h4>
                        <ul>
                            <li>Ensure the receipt is well-lit and clearly visible</li>
                            <li>Include all edges of the receipt in the image</li>
                            <li>Avoid shadows or glare on important text</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Step 2: Processing -->
            <section class="processing-section" id="processing-step">
                <div class="processing-container">
                    <div class="processing-animation">
                        <div class="spinner"></div>
                    </div>
                    <h2>Analyzing Your Receipt...</h2>
                    <p class="processing-text">Our AI is extracting information and validating data</p>
                    <div class="processing-steps">
                        <div class="process-item active">
                            <span class="process-icon">‚úì</span>
                            <span>Receipt uploaded successfully</span>
                        </div>
                        <div class="process-item active">
                            <span class="process-icon">‚ü≥</span>
                            <span>Extracting text and data</span>
                        </div>
                        <div class="process-item">
                            <span class="process-icon">‚óã</span>
                            <span>Categorizing expense</span>
                        </div>
                        <div class="process-item">
                            <span class="process-icon">‚óã</span>
                            <span>Validating compliance</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Review -->
            <section class="review-section" id="review-step">
                <div class="review-container">
                    <div class="review-header">
                        <h1>Review Extracted Data</h1>
                        <p class="review-subtitle">Verify and edit information for each receipt below</p>
                        <div class="review-summary" id="review-summary">
                            <span class="summary-count"><span id="receipts-count">0</span> receipts ready for review</span>
                        </div>
                    </div>

                    <!-- Dynamic Receipt Cards Container -->
                    <div class="receipts-review-list" id="receipts-review-list">
                        <!-- Receipt cards will be dynamically inserted here -->
                    </div>

                    <!-- Global Actions -->
                    <div class="review-global-actions" id="review-global-actions">
                        <button type="button" class="btn-secondary" onclick="goBackToUpload()">
                            ‚Üê Upload More Receipts
                        </button>
                        <div class="action-group">
                            <button type="button" class="btn-secondary" id="export-all-csv-btn">
                                üì• Export to CSV
                            </button>
                            <button type="button" class="btn-primary glow" id="approve-all-btn">
                                ‚úì Approve All & Save
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Success Message -->
            <section class="success-section" id="success-step">
                <div class="success-container">
                    <div class="success-animation">
                        <div class="success-checkmark">‚úì</div>
                    </div>
                    <h2>Receipt Processed Successfully!</h2>
                    <p>Your expense has been added to your dashboard</p>
                    <div class="success-actions">
                        <a href="dashboard.html" class="btn-primary">Back to Dashboard</a>
                        <button class="btn-secondary" onclick="uploadAnother()">Upload Another Receipt</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Camera Capture Modal -->
    <div class="camera-modal" id="camera-modal">
        <div class="camera-modal-content">
            <div class="camera-header">
                <h3>Capture Receipt</h3>
                <button class="camera-close-btn" id="camera-close-btn">&times;</button>
            </div>
            <div class="camera-body">
                <video id="camera-video" autoplay playsinline></video>
                <canvas id="camera-canvas" style="display: none;"></canvas>
                <img id="camera-preview" style="display: none;" alt="Captured photo">
            </div>
            <div class="camera-controls">
                <button class="btn-secondary" id="switch-camera-btn">
                    <span>üîÑ</span> Switch Camera
                </button>
                <button class="btn-primary capture-btn" id="capture-btn">
                    <span>üì∏</span> Capture
                </button>
                <button class="btn-secondary" id="retake-btn" style="display: none;">
                    <span>‚Ü©Ô∏è</span> Retake
                </button>
                <button class="btn-primary" id="use-photo-btn" style="display: none;">
                    <span>‚úì</span> Use Photo
                </button>
            </div>
        </div>
    </div>

    <script src="assets/js/api-config.js"></script>
    <script src="assets/js/main.js"></script>
</body>
</html>
